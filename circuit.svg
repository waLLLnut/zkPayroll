<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="786pt" height="614pt" viewBox="0.00 0.00 786.00 614.00">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 609.82)">
<title>LatticA_System_Architecture</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-609.82 782,-609.82 782,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_OnChain</title>
<polygon fill="#e3f2fd" stroke="#e3f2fd" points="8,-288.3 8,-462.9 389,-462.9 389,-288.3 8,-288.3"/>
<text xml:space="preserve" text-anchor="middle" x="198.5" y="-446.3" font-family="Times,serif" font-size="14.00" fill="#0d47a1">erc20_unshield</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_OffChain</title>
<polygon fill="#fff3e0" stroke="#fff3e0" points="410,-288.3 410,-597.82 770,-597.82 770,-288.3 410,-288.3"/>
<text xml:space="preserve" text-anchor="middle" x="590" y="-581.22" font-family="Times,serif" font-size="14.00" fill="#e65100">rlwe_audit</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_Verify</title>
<polygon fill="none" stroke="#666666" stroke-dasharray="5,2" points="275,-8 275,-280.3 491,-280.3 491,-8 275,-8"/>
</g>
<g id="clust4" class="cluster">
<title>cluster_Final</title>
</g>
<!-- User -->
<g id="node1" class="node">
<title>User</title>
<ellipse fill="#e1bee7" stroke="black" stroke-width="2" cx="310" cy="-541.22" rx="62.28" ry="24.32"/>
<text xml:space="preserve" text-anchor="middle" x="310" y="-544.52" font-family="Sans-Serif" font-size="11.00">User Secret Key</text>
<text xml:space="preserve" text-anchor="middle" x="310" y="-531.32" font-family="Sans-Serif" font-size="11.00">(sk ∈ Fp)</text>
</g>
<!-- DeriveID -->
<g id="node2" class="node">
<title>DeriveID</title>
<polygon fill="#ffffff" stroke="#0d47a1" points="374.59,-430.1 231.41,-430.1 231.41,-394.1 380.59,-394.1 380.59,-424.1 374.59,-430.1"/>
<polyline fill="none" stroke="#0d47a1" points="374.59,-430.1 374.59,-424.1"/>
<polyline fill="none" stroke="#0d47a1" points="380.59,-424.1 374.59,-424.1"/>
<text xml:space="preserve" text-anchor="middle" x="306" y="-415.4" font-family="Sans-Serif" font-size="11.00">1. Derive Identity (Grumpkin)</text>
<text xml:space="preserve" text-anchor="middle" x="306" y="-402.2" font-family="Sans-Serif" font-size="11.00">(x, y) = sk · G</text>
</g>
<!-- User&#45;&gt;DeriveID -->
<g id="edge5" class="edge">
<title>User-&gt;DeriveID</title>
<path fill="none" stroke="black" d="M310,-516.02C310,-516.02 310,-442.07 310,-442.07"/>
<polygon fill="black" stroke="black" points="313.5,-442.07 310,-432.07 306.5,-442.07 313.5,-442.07"/>
<text xml:space="preserve" text-anchor="middle" x="334.97" y="-479.9" font-family="Sans-Serif" font-size="10.00">Private Input</text>
</g>
<!-- RLWEMath -->
<g id="node7" class="node">
<title>RLWEMath</title>
<polygon fill="#ffcc80" stroke="#e65100" points="626,-435.9 424,-435.9 424,-431.9 420,-431.9 420,-427.9 424,-427.9 424,-396.3 420,-396.3 420,-392.3 424,-392.3 424,-388.3 626,-388.3 626,-435.9"/>
<polyline fill="none" stroke="#e65100" points="424,-431.9 428,-431.9 428,-427.9 424,-427.9"/>
<polyline fill="none" stroke="#e65100" points="424,-396.3 428,-396.3 428,-392.3 424,-392.3"/>
<text xml:space="preserve" text-anchor="middle" x="525" y="-422" font-family="Sans-Serif" font-size="11.00">2. RLWE Encryption &amp; Projection</text>
<text xml:space="preserve" text-anchor="middle" x="525" y="-408.8" font-family="Sans-Serif" font-size="11.00">c_0 = π₃₂ [ b(X)·r(X) + e₁(X) + m(X) ]</text>
<text xml:space="preserve" text-anchor="middle" x="525" y="-395.6" font-family="Sans-Serif" font-size="11.00">c₁(X) = a(X)·r(X) + e₂(X)</text>
</g>
<!-- User&#45;&gt;RLWEMath -->
<g id="edge6" class="edge">
<title>User-&gt;RLWEMath</title>
<path fill="none" stroke="black" d="M373.01,-541C384.02,-541 392.03,-541 392.03,-541 392.03,-541 392.03,-412 392.03,-412 392.03,-412 412.03,-412 412.03,-412"/>
<polygon fill="black" stroke="black" points="412.03,-415.5 422.03,-412 412.03,-408.5 412.03,-415.5"/>
<text xml:space="preserve" text-anchor="middle" x="452.77" y="-485.9" font-family="Sans-Serif" font-size="10.00">Private Input</text>
<text xml:space="preserve" text-anchor="middle" x="452.77" y="-473.9" font-family="Sans-Serif" font-size="10.00">(x,y encoded to m)</text>
</g>
<!-- WaCommit -->
<g id="node4" class="node">
<title>WaCommit</title>
<path fill="#ffffff" stroke="#0d47a1" d="M369.07,-332.3C369.07,-332.3 252.93,-332.3 252.93,-332.3 246.93,-332.3 240.93,-326.3 240.93,-320.3 240.93,-320.3 240.93,-308.3 240.93,-308.3 240.93,-302.3 246.93,-296.3 252.93,-296.3 252.93,-296.3 369.07,-296.3 369.07,-296.3 375.07,-296.3 381.07,-302.3 381.07,-308.3 381.07,-308.3 381.07,-320.3 381.07,-320.3 381.07,-326.3 375.07,-332.3 369.07,-332.3"/>
<text xml:space="preserve" text-anchor="middle" x="311" y="-317.6" font-family="Sans-Serif" font-size="11.00">3. WaCommitment</text>
<text xml:space="preserve" text-anchor="middle" x="311" y="-304.4" font-family="Sans-Serif" font-size="11.00">wa_com = Poseidon(1, x, y)</text>
</g>
<!-- DeriveID&#45;&gt;WaCommit -->
<g id="edge1" class="edge">
<title>DeriveID-&gt;WaCommit</title>
<path fill="none" stroke="black" d="M310.76,-393.7C310.76,-393.7 310.76,-344.13 310.76,-344.13"/>
<polygon fill="black" stroke="black" points="314.26,-344.13 310.76,-334.13 307.26,-344.13 314.26,-344.13"/>
</g>
<!-- NullifierCalc -->
<g id="node3" class="node">
<title>NullifierCalc</title>
<path fill="#ffffff" stroke="#0d47a1" d="M185.84,-332.3C185.84,-332.3 28.16,-332.3 28.16,-332.3 22.16,-332.3 16.16,-326.3 16.16,-320.3 16.16,-320.3 16.16,-308.3 16.16,-308.3 16.16,-302.3 22.16,-296.3 28.16,-296.3 28.16,-296.3 185.84,-296.3 185.84,-296.3 191.84,-296.3 197.84,-302.3 197.84,-308.3 197.84,-308.3 197.84,-320.3 197.84,-320.3 197.84,-326.3 191.84,-332.3 185.84,-332.3"/>
<text xml:space="preserve" text-anchor="middle" x="107" y="-317.6" font-family="Sans-Serif" font-size="11.00">2. Nullifier</text>
<text xml:space="preserve" text-anchor="middle" x="107" y="-304.4" font-family="Sans-Serif" font-size="11.00">nullifier = Poseidon(2, note_hash, sk)</text>
</g>
<!-- Out_OnChain -->
<g id="node9" class="node">
<title>Out_OnChain</title>
<path fill="#eeeeee" stroke="black" d="M296,-143.25C296,-143.25 326,-143.25 326,-143.25 332,-143.25 338,-149.25 338,-155.25 338,-155.25 338,-173.65 338,-173.65 338,-179.65 332,-185.65 326,-185.65 326,-185.65 296,-185.65 296,-185.65 290,-185.65 284,-179.65 284,-173.65 284,-173.65 284,-155.25 284,-155.25 284,-149.25 290,-143.25 296,-143.25"/>
<text xml:space="preserve" text-anchor="middle" x="310.63" y="-171.75" font-family="Sans-Serif" font-size="11.00">wa_com</text>
<polyline fill="none" stroke="black" points="284,-164.45 337.26,-164.45"/>
<text xml:space="preserve" text-anchor="middle" x="310.63" y="-150.55" font-family="Sans-Serif" font-size="11.00">nullifier</text>
</g>
<!-- NullifierCalc&#45;&gt;Out_OnChain -->
<g id="edge8" class="edge">
<title>NullifierCalc-&gt;Out_OnChain:null</title>
<path fill="none" stroke="black" d="M107,-295.87C107,-255.74 107,-164 107,-164 107,-164 272.08,-164 272.08,-164"/>
<polygon fill="black" stroke="black" points="272.08,-167.5 282.08,-164 272.08,-160.5 272.08,-167.5"/>
</g>
<!-- WaCommit&#45;&gt;Out_OnChain -->
<g id="edge7" class="edge">
<title>WaCommit-&gt;Out_OnChain:wa</title>
<path fill="none" stroke="black" d="M311,-295.81C311,-295.81 311,-197.48 311,-197.48"/>
<polygon fill="black" stroke="black" points="314.5,-197.48 311,-187.48 307.5,-197.48 314.5,-197.48"/>
</g>
<!-- Params -->
<g id="node5" class="node">
<title>Params</title>
<polygon fill="#ffe0b2" stroke="#e65100" points="588.44,-565.02 585.44,-569.02 564.44,-569.02 561.44,-565.02 417.56,-565.02 417.56,-517.42 588.44,-517.42 588.44,-565.02"/>
<text xml:space="preserve" text-anchor="middle" x="503" y="-551.12" font-family="Sans-Serif" font-size="11.00">RLWE Params</text>
<text xml:space="preserve" text-anchor="middle" x="503" y="-537.92" font-family="Sans-Serif" font-size="11.00">N=1024, Q=167772161</text>
<text xml:space="preserve" text-anchor="middle" x="503" y="-524.72" font-family="Sans-Serif" font-size="11.00">Constants: a(X), b(X) (Public Key)</text>
</g>
<!-- Params&#45;&gt;RLWEMath -->
<g id="edge2" class="edge">
<title>Params-&gt;RLWEMath</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M506.22,-516.94C506.22,-516.94 506.22,-447.79 506.22,-447.79"/>
<polygon fill="black" stroke="black" points="509.72,-447.79 506.22,-437.79 502.72,-447.79 509.72,-447.79"/>
</g>
<!-- NoiseCheck -->
<g id="node6" class="node">
<title>NoiseCheck</title>
<path fill="#ffffff" stroke="#e65100" d="M750.12,-559.22C750.12,-559.22 643.88,-559.22 643.88,-559.22 637.88,-559.22 631.88,-553.22 631.88,-547.22 631.88,-547.22 631.88,-535.22 631.88,-535.22 631.88,-529.22 637.88,-523.22 643.88,-523.22 643.88,-523.22 750.12,-523.22 750.12,-523.22 756.12,-523.22 762.12,-529.22 762.12,-535.22 762.12,-535.22 762.12,-547.22 762.12,-547.22 762.12,-553.22 756.12,-559.22 750.12,-559.22"/>
<text xml:space="preserve" text-anchor="middle" x="697" y="-544.52" font-family="Sans-Serif" font-size="11.00">1. Range Check (Lookup)</text>
<text xml:space="preserve" text-anchor="middle" x="697" y="-531.32" font-family="Sans-Serif" font-size="11.00">r, e₁, e₂ ∈ [-128, 127]</text>
</g>
<!-- NoiseCheck&#45;&gt;RLWEMath -->
<g id="edge3" class="edge">
<title>NoiseCheck-&gt;RLWEMath</title>
<path fill="none" stroke="black" d="M631.75,-541C617.83,-541 607.22,-541 607.22,-541 607.22,-541 607.22,-447.86 607.22,-447.86"/>
<polygon fill="black" stroke="black" points="610.72,-447.86 607.22,-437.86 603.72,-447.86 610.72,-447.86"/>
</g>
<!-- CTCommit -->
<g id="node8" class="node">
<title>CTCommit</title>
<path fill="#ffffff" stroke="#e65100" d="M688.65,-332.3C688.65,-332.3 523.35,-332.3 523.35,-332.3 517.35,-332.3 511.35,-326.3 511.35,-320.3 511.35,-320.3 511.35,-308.3 511.35,-308.3 511.35,-302.3 517.35,-296.3 523.35,-296.3 523.35,-296.3 688.65,-296.3 688.65,-296.3 694.65,-296.3 700.65,-302.3 700.65,-308.3 700.65,-308.3 700.65,-320.3 700.65,-320.3 700.65,-326.3 694.65,-332.3 688.65,-332.3"/>
<text xml:space="preserve" text-anchor="middle" x="606" y="-317.6" font-family="Sans-Serif" font-size="11.00">3. Ciphertext Commitment</text>
<text xml:space="preserve" text-anchor="middle" x="606" y="-304.4" font-family="Sans-Serif" font-size="11.00">ct_com = Poseidon(H(c_audit), H(c₁))</text>
</g>
<!-- RLWEMath&#45;&gt;CTCommit -->
<g id="edge4" class="edge">
<title>RLWEMath-&gt;CTCommit</title>
<path fill="none" stroke="black" d="M568.68,-387.92C568.68,-387.92 568.68,-344.19 568.68,-344.19"/>
<polygon fill="black" stroke="black" points="572.18,-344.19 568.68,-334.19 565.18,-344.19 572.18,-344.19"/>
</g>
<!-- Out_OffChain -->
<g id="node10" class="node">
<title>Out_OffChain</title>
<path fill="#eeeeee" stroke="black" d="M415,-229.4C415,-229.4 445,-229.4 445,-229.4 451,-229.4 457,-235.4 457,-241.4 457,-241.4 457,-259.8 457,-259.8 457,-265.8 451,-271.8 445,-271.8 445,-271.8 415,-271.8 415,-271.8 409,-271.8 403,-265.8 403,-259.8 403,-259.8 403,-241.4 403,-241.4 403,-235.4 409,-229.4 415,-229.4"/>
<text xml:space="preserve" text-anchor="middle" x="429.63" y="-257.9" font-family="Sans-Serif" font-size="11.00">wa_com</text>
<polyline fill="none" stroke="black" points="403,-250.6 456.26,-250.6"/>
<text xml:space="preserve" text-anchor="middle" x="429.63" y="-236.7" font-family="Sans-Serif" font-size="11.00">nullifier</text>
</g>
<!-- RLWEMath&#45;&gt;Out_OffChain -->
<g id="edge9" class="edge">
<title>RLWEMath-&gt;Out_OffChain:wa</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M440.5,-387.86C440.5,-387.86 440.5,-283.46 440.5,-283.46"/>
<polygon fill="black" stroke="black" points="444,-283.46 440.5,-273.46 437,-283.46 444,-283.46"/>
<text xml:space="preserve" text-anchor="middle" x="482.51" y="-357.3" font-family="Sans-Serif" font-size="10.00">Implicit (Derived)</text>
</g>
<!-- AuditLog -->
<g id="node12" class="node">
<title>AuditLog</title>
<path fill="#dcedc8" stroke="black" d="M665.17,-183.8C665.17,-186.17 638.65,-188.1 606,-188.1 573.35,-188.1 546.83,-186.17 546.83,-183.8 546.83,-183.8 546.83,-145.1 546.83,-145.1 546.83,-142.73 573.35,-140.8 606,-140.8 638.65,-140.8 665.17,-142.73 665.17,-145.1 665.17,-145.1 665.17,-183.8 665.17,-183.8"/>
<path fill="none" stroke="black" d="M665.17,-183.8C665.17,-181.43 638.65,-179.5 606,-179.5 573.35,-179.5 546.83,-181.43 546.83,-183.8"/>
<text xml:space="preserve" text-anchor="middle" x="606" y="-167.75" font-family="Sans-Serif" font-size="11.00">AuditLog Contract</text>
<text xml:space="preserve" text-anchor="middle" x="606" y="-154.55" font-family="Sans-Serif" font-size="11.00">Stores: ct_commitment</text>
</g>
<!-- CTCommit&#45;&gt;AuditLog -->
<g id="edge10" class="edge">
<title>CTCommit-&gt;AuditLog</title>
<path fill="none" stroke="black" d="M606,-295.93C606,-295.93 606,-199.94 606,-199.94"/>
<polygon fill="black" stroke="black" points="609.5,-199.94 606,-189.94 602.5,-199.94 609.5,-199.94"/>
</g>
<!-- Match -->
<g id="node11" class="node">
<title>Match</title>
<polygon fill="#ffcdd2" stroke="#c62828" points="383,-84.8 282.99,-50.4 383,-16 483.01,-50.4 383,-84.8"/>
<text xml:space="preserve" text-anchor="middle" x="383" y="-53.7" font-family="Sans-Serif" font-size="11.00">MUST MATCH</text>
<text xml:space="preserve" text-anchor="middle" x="383" y="-40.5" font-family="Sans-Serif" font-size="11.00">(Constraint Check)</text>
</g>
<!-- Out_OnChain&#45;&gt;Match -->
<g id="edge11" class="edge">
<title>Out_OnChain:wa-&gt;Match</title>
<path fill="none" stroke="#c62828" stroke-width="2" d="M311,-163.99C311,-140.04 311,-83.67 311,-60.56"/>
</g>
<!-- Out_OffChain&#45;&gt;Match -->
<g id="edge12" class="edge">
<title>Out_OffChain:wa-&gt;Match</title>
<path fill="none" stroke="#c62828" stroke-width="2" d="M430,-250.16C430,-216.02 430,-111.87 430,-69.06"/>
</g>
<!-- Threshold -->
<g id="node13" class="node">
<title>Threshold</title>
<polygon fill="#fff9c4" stroke="black" points="681.66,-74.2 528.34,-74.2 528.34,-26.6 687.66,-26.6 687.66,-68.2 681.66,-74.2"/>
<polyline fill="none" stroke="black" points="681.66,-74.2 681.66,-68.2"/>
<polyline fill="none" stroke="black" points="687.66,-68.2 681.66,-68.2"/>
<text xml:space="preserve" text-anchor="middle" x="608" y="-60.3" font-family="Sans-Serif" font-size="11.00">Threshold Decryption (2-of-3)</text>
<text xml:space="preserve" text-anchor="middle" x="608" y="-47.1" font-family="Sans-Serif" font-size="11.00">Decrypt(c_audit, c₁) → (x, y)</text>
<text xml:space="preserve" text-anchor="middle" x="608" y="-33.9" font-family="Sans-Serif" font-size="11.00">m' = c_audit - (d₁ + d₂) mod Q</text>
</g>
<!-- AuditLog&#45;&gt;Threshold -->
<g id="edge13" class="edge">
<title>AuditLog-&gt;Threshold</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M606,-140.54C606,-140.54 606,-86.18 606,-86.18"/>
<polygon fill="black" stroke="black" points="609.5,-86.18 606,-76.18 602.5,-86.18 609.5,-86.18"/>
<text xml:space="preserve" text-anchor="middle" x="647.11" y="-109.8" font-family="Sans-Serif" font-size="10.00">Upon Audit Request</text>
</g>
</g>
</svg>